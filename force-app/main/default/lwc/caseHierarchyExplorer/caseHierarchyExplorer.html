<template>
    <!-- CONFIG MODE -->
    <template if:true={isConfigMode}>
        <lightning-card title="Configure Columns">
            <div class="slds-p-horizontal_small">
                <lightning-dual-listbox
                    name="cols"
                    label="Columns"
                    source-label="Available"
                    selected-label="Shown"
                    options={columnOptions}
                    value={selectedKeys}
                    onchange={handleColumnPick}>
                </lightning-dual-listbox>

                <div class="slds-m-top_medium">
                    <lightning-button label="Cancel"
                                      onclick={handleCancel}>
                    </lightning-button>
                    <lightning-button class="slds-m-left_small"
                                      variant="brand"
                                      label="Save"
                                      onclick={handleSave}>
                    </lightning-button>
                </div>
            </div>
        </lightning-card>
    </template>

    <!-- NORMAL VIEW -->
    <template if:false={isConfigMode}>
        <lightning-card title="Case Hierarchy">
            <div class="slds-p-horizontal_small">
                <lightning-button label="Configure Columns"
                                  onclick={handleToggleConfig}>
                </lightning-button>

                <template if:true={hasError}>
                    <div class="slds-notify slds-notify_alert slds-theme_error slds-m-top_small" role="alert">
                        <span class="slds-assistive-text">Error</span>
                        <h2>{errorMessage}</h2>
                    </div>
                </template>

                <template if:true={noCasesFound}>
                    <div class="slds-notify slds-notify_alert slds-theme_info slds-m-top_medium" role="alert">
                        <span class="slds-assistive-text">Info</span>
                        <h2>No cases found for this record.</h2>
                    </div>
                </template>

                <template if:false={noCasesFound}>
                    <div class="slds-m-top_medium">
                        <lightning-tree-grid
                            key={treeGridKey}
                            key-field="id"
                            columns={columns}
                            data={treeData}
                            expanded-rows={expandedRows}
                            onrowtoggle={handleRowToggle}
                            is-loading={isLoading}>
                        </lightning-tree-grid>
                    </div>
                </template>
            </div>
        </lightning-card>
    </template>
</template>
